---
// src/components/shared/SimpleIsoGrid.astro
---
<div class="iso-background-root" aria-hidden="true">
  <div class="perspective-shaper">
    <div class="iso-plane"></div>
  </div>
  <div class="vignette-overlay"></div>
</div>

<style>
  :root {
    --bg-color: var(--bg-primary);
    /* This must match your Risk Cube's opacity and color theme */
    --line-color: color-mix(in srgb, var(--bg-inverse) 10%, transparent);
  }

  .iso-background-root {
    position: fixed;
    inset: 0;
    z-index: -10;
    background: var(--bg-color);
    overflow: hidden;
  }

  .perspective-shaper {
    /* MATCHING HERO PERSPECTIVE: This fixes the edge misalignment */
    perspective: 1200px;
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .iso-plane {
    position: absolute;
    width: 400vmax; /* Extra large to prevent edges showing during scroll */
    height: 400vmax;
    
    /* MATCHING HERO TRANSFORM */
    transform: rotateX(54deg) rotateZ(45deg);
    
    /* THE GRID MATH: 
       To align with 'clamp(250px, 70vmin, 500px)' divided by 8 cells:
       We use the same clamp logic for the background-size.
    */
    background-image: 
      linear-gradient(to right, var(--line-color) 1px, transparent 1px),
      linear-gradient(to bottom, var(--line-color) 1px, transparent 1px);
    
    /* Standard cell size = (Total Grid Size / 8) */
    background-size: calc(clamp(250px, 70vmin, 500px) / 8) calc(clamp(250px, 70vmin, 500px) / 8);
    background-position: center center;
    
    transform-style: preserve-3d;
  }

  .vignette-overlay {
    position: absolute;
    inset: 0;
    /* Fades the background grid so it doesn't distract from the Hero */
    background: radial-gradient(
      circle at center,
      transparent 20%,
      var(--bg-color) 80%
    );
    pointer-events: none;
  }

  media (prefers-reduced-motion: no-preference) {
    .iso-plane {
      animation: isoGridMove 120s linear infinite;
      transform: rotateX(5deg) rotateZ(45deg);
    }
  }
</style>