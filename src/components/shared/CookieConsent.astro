---
// src/components/shared/CookieConsent.astro
---

<div id="cookie-consent-banner" class="banner-container">
  <div class="card">
    <div class="flex-container">
      <div class="icon-wrapper">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 4 4 0 0 1-5-5"></path>
          <path d="M8.5 8.5v.01"></path><path d="M16 15.5v.01"></path>
          <path d="M12 12v.01"></path><path d="M15.5 16v.01"></path>
          <path d="M8.5 12.5v.01"></path>
        </svg>
      </div>
      <div class="content-wrapper">
        <p class="heading">We value your privacy</p>
        <p class="subheading">
          We use essential cookies for site functionality. Please see our
          <a href="/terms-and-privacy">Terms & Privacy</a> for more details.
        </p>
        <div class="button-group">
          <button id="btn-accept" class="btn btn-primary">Accept</button>
          <button id="btn-decline" class="btn btn-light">Essential Only</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script is:inline>
  document.addEventListener("DOMContentLoaded", () => {
    const banner = document.getElementById("cookie-consent-banner");
    const acceptBtn = document.getElementById("btn-accept");
    const declineBtn = document.getElementById("btn-decline");
    if (!banner || !acceptBtn || !declineBtn) return;

    const updateConsent = (consentState) => {
      if (typeof window.gtag === "function") {
        window.gtag("consent", "update", { analytics_storage: consentState });
      }
    };
    const handleAccept = () => {
      localStorage.setItem("vg-cookie-consent", "accepted");
      localStorage.setItem("vg-cookie-timestamp", new Date().toISOString());
      banner.style.display = "none";
      updateConsent("granted");
      if (typeof window.gtag === "function") {
        window.gtag("event", "cookie_consent", {
          event_category: "engagement",
          event_label: "accepted",
        });
      }
    };
    const handleDecline = () => {
      localStorage.setItem("vg-cookie-consent", "declined");
      localStorage.setItem("vg-cookie-timestamp", new Date().toISOString());
      banner.style.display = "none";
      updateConsent("denied");
    };

    const consent = localStorage.getItem("vg-cookie-consent");
    if (!consent) {
      setTimeout(() => {
        banner.style.display = "block";
      }, 1000);
    } else if (consent === "accepted") {
      updateConsent("granted");
    }

    acceptBtn.addEventListener("click", handleAccept);
    declineBtn.addEventListener("click", handleDecline);
  });
</script>

<style>
  .banner-container {
    position: fixed;
    bottom: 1rem;
    left: 1rem;
    right: 1rem;
    z-index: 50;
    max-width: 28rem;
    margin: auto;
    display: none;
  }
  .card {
    background-color: var(--bg-secondary);
    padding: 1rem;
    border-radius: 0.5rem;
    box-shadow:
      0 10px 15px -3px var(--shadow-color-strong),
      0 4px 6px -2px var(--shadow-color);
    border: 1px solid var(--border-primary);
    transition:
      background-color 0.3s ease,
      border-color 0.3s ease;
  }
  .flex-container {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
  }
  .icon-wrapper {
    flex-shrink: 0;
    margin-top: 0.25rem;
    color: var(--brand-pink);
  }
  .content-wrapper {
    flex: 1;
  }
  .heading {
    font-weight: 600;
    color: var(--text-primary);
    margin: 0 0 0.5rem 0;
  }
  .subheading {
    font-size: 0.875rem;
    color: var(--text-secondary);
    margin: 0 0 1rem 0;
    line-height: 1.5;
  }
  .subheading a {
    color: var(--accent);
    text-decoration: underline;
  }
  .button-group {
    display: flex;
    gap: 0.5rem;
    justify-content: flex-end;
    width: 100%;
  }
  .btn {
    padding: 0.5rem 1rem;
    border-radius: 0.375rem;
    border: none;
    font-weight: 600;
    cursor: pointer;
    transition:
      background-color 0.2s ease,
      transform 0.2s ease;
  }
  .btn:hover {
    transform: scale(1.05);
  }
  .btn-primary {
    background-color: var(--btn-primary-bg);
    color: var(--btn-primary-text);
  }
  .btn-primary:hover {
    background-color: var(--btn-primary-bg-hover);
  }
  .btn-light {
    background-color: var(--btn-secondary-bg);
    color: var(--btn-secondary-text);
  }
  .btn-light:hover {
    background-color: var(--btn-secondary-bg-hover);
  }
</style>
